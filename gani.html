<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>BEX - ì´ê´€í¬</title>
    <link rel="stylesheet" href="index.css">
    <link rel="icon" type="images/png" href="img/logo(1).png">
    <script src="https://kit.fontawesome.com/abd4943d11.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
    />
    <style>
        body {
            background-color: #f4efd2;
        }

        .header-text {
            color: black;
        }

        .team-icon-each {
            margin-right: 20px;
        }

        .icon-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-end;
            margin-top: 5px;
        }

        .icon {
            padding-top: 5px;
            padding-right: 15px;
        }

        .lead {
            padding-top: 50px;
        }

    </style>
</head>
<body>

<!-- í—¤ë” -->
<div id="header"></div>

<!-- ì†Œê°œë€ -->
<div class="container marketing">
    <div class="row featurette">
        <div class="col-md-7 order-md-2">
            <h2 class="featurette-heading fw-normal lh-1">
                ì´ê´€í¬
            </h2>
            <p>- ğŸ¡ ì§€ê¸ˆ ëŒ€ì „ì— ì‚´ê³  ìˆê³  ì˜¬í•´ ëŒ€í•™êµ ì¡¸ì—…í–ˆì–´ìš”!</p>
            <p>- ğŸ§ MBTI: INTP / ì™¸í–¥ì ì¸ ë¶„ë“¤ë„ ëŒ€í™˜ì˜!</p>
            <p>- ğŸ‘ ê´€ì‹¬ì‚¬ : í´ë¼ì´ë°, ì¸ë””, ì•„ì´ëŒ ìŒì•…</p>
            <p>- ğŸ® ê°œì¸ í”„ë¡œì íŠ¸ : ì¡¸ì—… ì‘í’ˆìœ¼ë¡œ unityë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê²Œì„ ì œì‘ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤!</p>
            <p>- ğŸ“‹ í˜‘ì—… ìŠ¤íƒ€ì¼ : ê²½í—˜ì´ë‚˜ ì§€ì‹ì´ ë¶€ì¡±í•´ì„œ ì—´ì‹¬íˆ ë°°ìš°ë©´ì„œ í•˜ê² ìŠµë‹ˆë‹¤!</p>
        </div>
        <div class="col-md-4 order-md-1">
            <img src="img/gwan.jpg" class="profile-img"/>
            </svg>
        </div>
        <div class="col-md-4 order-md-3 icon-container" style="justify-content: space-evenly; margin-top: 10px">
            <a href="https://github.com/yigani"><i class="fa-brands fa-github fa-2xl" style="color: #479647;"></i></a>
            <a href="https://velog.io/@pop3121/posts"><i class="fa-brands fa-vimeo fa-2xl" style="color: #479647;"></i></a>
        </div>
    </div>
    <hr class="featurette-divider" style="margin-bottom: 0"/>
</div>

<!-- ë°©ëª…ë¡ -->
<div class="container">
    <div style="background: #ffffff; width: 100%; padding: 10px;">
        <!-- ë°©ëª…ë¡ ê°œë°œ-->
        <table style="width: 100%; margin-bottom: 10px">
            <tbody id="test">
            </tbody>
        </table>

        <div>
            <div style="width: 100%; display: flex; justify-content: space-evenly">
                <input type="text" class="nickname-box" id="user" maxlength="8" placeholder="ì´ë¦„"/>
                <textarea class="content-box" id="content" maxlength="100" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="mybtn">
                <button class="confirm" type="button">ë“±ë¡</button>
            </div>
        </div>
    </div>

</div>
</body>

<style>
    .profile-img {
        width: 200px; /* í¬ê¸° ì¡°ì • (ì›í˜• ìœ ì§€) */
        height: 200px; /* í¬ê¸° ì¡°ì • (ì›í˜• ìœ ì§€) */
        object-fit: cover; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ìë¥´ê¸° */
        border-radius: 50%; /* ì›í˜• ëª¨ì–‘ ì ìš© */
        display: block; /* ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€ */
        margin: 0 auto; /* ìë™ ë§ˆì§„ìœ¼ë¡œ ê°€ìš´ë° ì •ë ¬ */
    }

    input, textarea {
        height: 80px;
        padding-left: 10px;
        padding-bottom: 50px;
        text-align: left;
        vertical-align: top;
        border-radius: 3px;
        border: 1px #a5a5a5 solid;
    }

    input:focus, textarea:focus {
        outline: #479647 1px solid;
    }

    td {
        height: 30px;
        padding: 0 10px;
    }

    .nickname-box {
        width: 20%;
    }

    .content-box {
        width: 79%;
    }

    .mybtn {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
    }

    .confirm {
        border: none;
        background: #e8d98f;
        border-radius: 3px;
        float: right;
        font-weight: bold;
        font-size: 13px;
        height: 26px;
        width: 50px;
        color: white;
    }

    button:disabled {
        opacity: 0.3;
    }
    .name-cell {
        background-color: lightgreen;
        color: white;
        font-weight: bold;
        text-align: center;
        padding: 8px;
        border-radius: 5px;
        width: 130px;
        white-space: nowrap;
    }

</style>

<script>
    $(function () {
        $("#header").load("header.html");
    })

    $(document).ready(function () {
        $(".confirm").prop("disabled", true);
        $('#user, #content').on('keyup', function () {
            const user = $('#user').val();
            const content = $('#content').val();

            if (user === "" || content === "") {
                $(".confirm").prop("disabled", true);
            } else {
                $(".confirm").prop("disabled", false);
            }
        });
    });
</script>

<script type="module">
    import {db} from "./firebase.js";
    import {
        collection,
        addDoc,
        getDocs,
        deleteDoc,
        doc,
        query,
        orderBy
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // ğŸ”¹ ëŒ“ê¸€ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $(".confirm").click(async function () {
        const user = $('#user').val().trim();
        const content = $('#content').val().trim();

        if (!user || !content) {
            alert("ì´ë¦„ê³¼ ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        const docData = {
            id: "ê´€í¬",  // íŠ¹ì • ìœ ì € ID
            user: user,
            content: content,
            timestamp: new Date()  // ğŸ”¥ ìµœì‹  ì •ë ¬ì„ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
        };

        try {
            await addDoc(collection(db, "comments"), docData);
            $('#user').val("");
            $('#content').val("");
            loadComments();
        } catch (error) {
            // console.error("ëŒ“ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            alert("ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    });

    async function loadComments() {
        // console.log("Firestoreì—ì„œ ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
        const commentList = $("#test");
        commentList.empty();

        try {
            const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
            const querySnapshot = await getDocs(q);

            querySnapshot.forEach((doc) => {
                const row = doc.data();
                if (row.id === "ê´€í¬") {
                    const commentId = doc.id;
                    const temp_html = `
                        <tr style="border-bottom: 1px solid #f3f3f3;">
                            <td class="name-cell">${row.user}</td>
                            <td>${row.content}</td>
                            <td style="width: 5%; text-align: right;">
                                <button class="delete-btn" data-id="${commentId}" style="border: none; background: none; cursor: pointer; color: red;">âŒ</button>
                            </td>
                        </tr>
                    `;
                    commentList.append(temp_html);
                }
            });

            $(".delete-btn").click(async function () {
                const commentId = $(this).data("id");
                await deleteDoc(doc(db, "comments", commentId));
                loadComments();
            });

        } catch (error) {
            // console.error("ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
        }
    }

    $(document).ready(function () {
        loadComments();
    });

</script>
</html>
